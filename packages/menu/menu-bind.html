<template component>
  <l-m src="./menu.html"></l-m>
  <style>
    :host {
      display: contents;
    }
    p-placement {
      margin: 0;
      padding: 0;
    }

    p-placement::part(container) {
      margin: 0;
      padding: 0;
    }
  </style>
  <p-placement attr:placement="placement">
    <slot></slot>
  </p-placement>
  <script>
    export default async ({ load }) => {
      await load("../tooltips/placement.html");

      return {
        tag: "p-menu-bind",
        attrs: {
          anchor: null,
          event: null,
          placement: null,
        },
        watch: {
          ["anchor,event,placement"]() {
            this.init();
          },
        },
        proto: {
          init() {
            if (!this.ele.isConnected) {
              return;
            }

            const menu = this.$("p-menu");

            if (!menu) {
              return;
            }

            const { anchor, event, placement } = this;
            const marked = `${anchor}-${event}-${placement}-${menu.xid}`;
            if (marked === this._before_init_marked) {
              return;
            }

            this._before_init_marked = marked;

            const anchorEl = this.root.$(anchor);
            const placementEl = this.shadow.$("p-placement");

            placementEl._refreshPosition(anchorEl);

            console.log("menu-bind", anchorEl, marked);
          },
        },
        attached() {
          this.init();
        },
      };
    };
  </script>
</template>
