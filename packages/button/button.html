<template component>
  <l-m src="../wave/p-wave.html"></l-m>
  <style>
    :host {
      display: inline-block;
      --pui-border-radius: 30px;
    }

    .container {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: var(--pui-border-radius);
      box-sizing: border-box;
      height: 36px;
      font-size: 14px;
      /* padding: calc(var(--pui-space-y) * 2 ) calc(var(--pui-space-x) * 4); */
      padding: 0 calc(var(--pui-space-x) * 2.8);
      cursor: pointer;
      user-select: none;
      color: var(--font-color);
      border: transparent solid 0px;
      background-color: transparent;
    }

    .container[variant="contained"] {
      background-color: var(--main-color);
      box-shadow: var(--contained-shadow);
      transition: all ease 0.2s;
    }

    .container[variant="contained"]:hover {
      box-shadow: var(--contained-hover-shadow);
    }

    .container[variant="contained"]:active {
      box-shadow: var(--contained-active-shadow);
    }

    .container[variant="outlined"] .fake-border {
      display: block;
      content: "";
      position: absolute;
      width: calc(100% - 1px);
      height: calc(100% - 1px);
      left: 0;
      top: 0;
      border: var(--main-color) solid 0.5px;
      border-radius: var(--pui-border-radius);
    }
    .container[variant="outlined"]:hover .fake-border {
      width: calc(100% - 2px);
      height: calc(100% - 2px);
      border-width: 1px;
    }

    .container[variant="text"] {
      background-color: transparent;
      border-color: transparent;
    }

    .container[variant="outlined"],
    .container[variant="text"] {
      color: var(--main-color);
    }

    .container[size="small"] {
      /* padding: calc(var(--pui-space-y) * 1) calc(var(--pui-space-x) * 2); */
      padding: 0 calc(var(--pui-space-x) * 2.5);
      height: 30px;
      font-size: 12px;
    }
    .container[size="large"] {
      /* padding: calc(var(--pui-space-y) * 2) calc(var(--pui-space-x) * 4); */
      padding: 0 calc(var(--pui-space-x) * 3);
      height: 42px;
      font-size: 18px;
    }
    .container.disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none !important;
    }
    .container .hover-place {
      display: block;
      box-sizing: border-box;
      position: absolute;
      z-index: 1;
      border-radius: var(--pui-border-radius);
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      transition: all ease 0.2s;
    }
    .container:hover .hover-place {
      background-color: var(--main-hover-color);
    }

    .outlined-place {
      display: none;
    }

    .container[variant="outlined"] .outlined-place {
      display: block;
    }

    .text-place {
      display: none;
    }

    .container[variant="text"] .text-place {
      display: block;
    }

    .contained-place {
      display: none;
    }

    .container[variant="contained"] .contained-place {
      display: block;
    }

    ::slotted([slot="prefix"]) {
      font-size: 18px;
      margin-right: var(--pui-space-x);
    }
    ::slotted([slot="suffix"]) {
      font-size: 18px;
      margin-left: var(--pui-space-x);
    }

    :host([size="large"]) ::slotted([slot="prefix"]),
    :host([size="large"]) ::slotted([slot="suffix"]) {
      font-size: 24px;
    }
    :host([size="small"]) ::slotted([slot="prefix"]),
    :host([size="small"]) ::slotted([slot="suffix"]) {
      font-size: 16px;
    }
  </style>
  <button
    class="container"
    attr:variant="variant"
    attr:size="size"
    class:disabled="typeof disabled === 'string'"
    on:click="clickCon"
    part="container"
    attr:disabled="disabled"
  >
    <slot name="prefix"></slot>
    <slot></slot>
    <slot name="suffix"></slot>
    <div class="fake-border outlined-place" part="outlined"></div>
    <div class="hover-place" part="hover"></div>
    <div class="text-place" part="text-place"></div>
    <div class="contained-place" part="contained-place"></div>
    <x-if :value="disabled === null">
      <p-wave style="z-index: 2"></p-wave>
    </x-if>
  </button>
  <script>
    import "../init.js";
    import { isDark } from "../commons/data.js";
    import { convertToRGBA, adjustBrightness } from "../commons/util.js";
    export default {
      tag: "p-button",
      attrs: {
        variant: "contained",
        size: null,
        color: "normal",
        disabled: null,
      },
      watch: {
        color(color) {
          if (color) {
            this.style.setProperty("--main-color", `var(--pui-${color}-color)`);
            this.style.setProperty(
              "--font-color",
              `var(--pui-${color}-font-color)`
            );
          }
        },
        isDark() {
          setTimeout(() => {
            this.refreshHoverColor();
          }, 100);
        },
      },
      proto: {
        clickCon(e) {
          if (typeof this.disabled === "string") {
            e.stopImmediatePropagation();
          }
        },
        refreshHoverColor() {
          const color = getComputedStyle(this.ele).getPropertyValue(
            `--main-color`
          );

          if (color) {
            const newColor = convertToRGBA(color);

            this.style.setProperty("--main-hover-color", newColor);
          }
        },
      },
      data: {
        isDark: {},
      },
      attached() {
        this.isDark = isDark;
      },
      detached() {
        this.isDark = {};
      },
    };
  </script>
</template>
